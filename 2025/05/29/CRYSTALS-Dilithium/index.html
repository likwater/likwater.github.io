<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CRYSTALS-Dilithium | Water's Blog</title><meta name="author" content="Water"><meta name="copyright" content="Water"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="参考文献 论文：[CRYSTALS-Dilithium Algorithm Specifications and Supporting Documentation (Version 3.1)](CRYSTALS-Dilithium (pq-crystals.org)) https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;A_4PwpCL0p3M1Z4D6lcTsQ  困难问题 MSIS Self">
<meta property="og:type" content="article">
<meta property="og:title" content="CRYSTALS-Dilithium">
<meta property="og:url" content="https://likwater.github.io/2025/05/29/CRYSTALS-Dilithium/index.html">
<meta property="og:site_name" content="Water&#39;s Blog">
<meta property="og:description" content="参考文献 论文：[CRYSTALS-Dilithium Algorithm Specifications and Supporting Documentation (Version 3.1)](CRYSTALS-Dilithium (pq-crystals.org)) https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;A_4PwpCL0p3M1Z4D6lcTsQ  困难问题 MSIS Self">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://likwater.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-05-29T09:29:17.182Z">
<meta property="article:modified_time" content="2025-05-29T09:45:12.907Z">
<meta property="article:author" content="Water">
<meta property="article:tag" content="crypto">
<meta property="article:tag" content="post-quantum">
<meta property="article:tag" content="digital signatur">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://likwater.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CRYSTALS-Dilithium",
  "url": "https://likwater.github.io/2025/05/29/CRYSTALS-Dilithium/",
  "image": "https://likwater.github.io/img/butterfly-icon.png",
  "datePublished": "2025-05-29T09:29:17.182Z",
  "dateModified": "2025-05-29T09:45:12.907Z",
  "author": [
    {
      "@type": "Person",
      "name": "Water",
      "url": "https://likwater.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/butterfly-icon.png"><link rel="canonical" href="https://likwater.github.io/2025/05/29/CRYSTALS-Dilithium/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CRYSTALS-Dilithium',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/background.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Water's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">CRYSTALS-Dilithium</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CRYSTALS-Dilithium</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-29T09:29:17.182Z" title="发表于 2025-05-29 17:29:17">2025-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-29T09:45:12.907Z" title="更新于 2025-05-29 17:45:12">2025-05-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/crypto/">crypto</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li>论文：[CRYSTALS-Dilithium Algorithm Specifications and Supporting Documentation (Version 3.1)](<a target="_blank" rel="noopener" href="https://pq-crystals.org/dilithium/data/dilithium-specification-round3-20210208.pdf">CRYSTALS-Dilithium (pq-crystals.org)</a>)</li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/A_4PwpCL0p3M1Z4D6lcTsQ">https://mp.weixin.qq.com/s/A_4PwpCL0p3M1Z4D6lcTsQ</a></li>
</ol>
<h1 id="困难问题"><a href="#困难问题" class="headerlink" title="困难问题"></a>困难问题</h1><ol>
<li>MSIS</li>
<li>SelfTargetMSIS</li>
<li>MLWE</li>
</ol>
<h1 id="数学符号"><a href="#数学符号" class="headerlink" title="数学符号"></a>数学符号</h1><ol>
<li><p><strong><code>:=</code></strong> 表示<strong>定义（define as）</strong>，用于明确表达某个符号或表达式的定义。</p>
</li>
<li><p><strong>形式化意义</strong>：<strong><code>:=</code></strong> 的左侧是要被定义的符号，右侧是该符号的具体定义。</p>
</li>
<li><p><strong>区别于等号（<code>=</code>）</strong>：普通等号 <code>=</code> 表示等值或相等，而 <strong><code>:=</code></strong> 强调这是一个新的定义或约定。</p>
</li>
<li><p>示例：$f(x) :&#x3D; x^2 + 1$表示$f(x)$被定义为$x^2 + 1$。</p>
</li>
</ol>
<h1 id="算法中调用的函数"><a href="#算法中调用的函数" class="headerlink" title="算法中调用的函数"></a>算法中调用的函数</h1><ol>
<li><p>$Power2Round_q(r, d)$:</p>
<ol>
<li>$r :&#x3D; r \mod^+ q$</li>
<li>$r_0 :&#x3D; r \mod 2^d$</li>
<li>$return\left( \frac{(r - r_0)}{2^d}, r_0 \right)$</li>
</ol>
</li>
<li><p>$MakeHint_q(z, r, \alpha)$ </p>
<ol>
<li>$r_1 :&#x3D; \text{HighBits}_q(r, \alpha)$</li>
<li>$v_1 :&#x3D; \text{HighBits}_q(r + z, \alpha)$ </li>
<li>$return[r_1 \neq v_1]$</li>
</ol>
</li>
<li><p>$UseHint_q(h, r, \alpha)$ </p>
<ol>
<li>$m :&#x3D; \frac{(q - 1)}{\alpha}$</li>
<li>$(r_1, r_0) :&#x3D; \text{Decompose}_q(r, \alpha)$</li>
<li>$If{h &#x3D; 1 \quad and \quad r_0 &gt; 0} \quad return \quad (r_1 + 1) \mod^+ m$ </li>
<li>$If{h &#x3D; 1 \quad and \quad r_0 \leq 0} \quad return \quad (r_1 - 1) \mod^+ m$ </li>
<li>$return \quad r_1$</li>
</ol>
</li>
<li><p>$Decompose_q(r, \alpha)$}</p>
<ol>
<li><p>$r :&#x3D; r \mod^+ q$</p>
</li>
<li><p>$r_0 :&#x3D; r \mod^{\pm} \alpha$ </p>
</li>
<li><p>$If{r - r_0 &#x3D; q - 1}$</p>
<ol>
<li>$r_1 :&#x3D; 0; r_0 :&#x3D; r_0 - 1$</li>
</ol>
</li>
<li><p>$Else  \quad r_1 :&#x3D; \frac{r - r_0}{\alpha}$(相当于$r_1 &#x3D; \lfloor \frac{r}{\alpha} \rfloor$)</p>
</li>
<li><p>$return (r_1, r_0)$</p>
</li>
</ol>
</li>
<li><p>$HighBits_q(r, \alpha)$</p>
<ol>
<li>$(r_1, r_0) :&#x3D; \text{Decompose}_q(r, \alpha)$</li>
<li>$return \quad r_1$</li>
</ol>
</li>
<li><p>$LowBits_q(r, \alpha)$</p>
<ol>
<li>$(r_1, r_0) :&#x3D; \text{Decompose}_q(r, \alpha)$</li>
<li>$return \quad r_0$</li>
</ol>
</li>
<li><p>$SampleInBall$(从签名中的压缩表示$ \tilde{c}$ 中还原出完整的多项式 $c$):</p>
<ol>
<li><p>$\tilde{c}$ 是 $c$ 的压缩形式，作为签名的一部分被发送。$c$ 是一个稀疏多项式，属于一个有限域（模 $q$的环），其系数仅为 −1、0、+1，并且满足固定的汉明重量（非零系数的个数是固定的）。$\tilde{c}$ 是一种编码，仅记录了 $c$中非零系数的位置和符号。函数 $SampleInBall$ 是从压缩的 $\tilde{c}$中重新构造稀疏多项式 $c$。</p>
</li>
<li><p>稀疏多项式$ c$的性质：$c$ 是一个 n次多项式（即维度为 n的向量）。其中有$ \tau$个系数是非零值（−1 或 +1），其他的系数是 0。$\tau$是协议中预先定义的固定参数。</p>
</li>
<li><p>压缩表示 $\tilde{c}$ ：$\tilde{c}$  记录了 $\tau$个非零值的位置信息以及它们的符号。一般使用一个紧凑的二进制编码格式表示，具体编码方式会因实现而异。</p>
</li>
<li><p>重构过程（SampleInBall）：根据 $\tilde{c}$ 中的编码信息，确定 $\tau$个非零值的位置。读取这些位置的符号（−1 或 +1）。构造一个多项式 $c$，其系数根据以上信息设置为 −1、+1，其他位置的系数置为 0。</p>
</li>
</ol>
</li>
</ol>
<h1 id="引理"><a href="#引理" class="headerlink" title="引理"></a>引理</h1><h2 id="引理1"><a href="#引理1" class="headerlink" title="引理1"></a>引理1</h2><p>假设 $q$和 $\alpha$是正整数，满足 $q&gt;2\alpha$，$q\equiv1 \pmod {\alpha}$且$\alpha$为偶数。设 $r $和$ z$是 $R_{q}$中的元素向量，其中 $|z|<em>{\infty}\leq\frac{\alpha}{2}$，并且 $h$，$h’$是比特向量。那么$ HighBits$，$MakeHint</em>{q}$和 $UseHint_{q}$算法满足以下性质。</p>
<h3 id="性质1"><a href="#性质1" class="headerlink" title="性质1"></a>性质1</h3><p>$UseHint_{q}(MakeHint_{q}(z,r,\alpha),r,\alpha)&#x3D;HighBits_{q}(r + z,\alpha)$</p>
<h3 id="性质2"><a href="#性质2" class="headerlink" title="性质2"></a>性质2</h3><p>令$ v_{1}&#x3D;UseHint_{q}(h,r,\alpha)$，则$ \left|r - v_{1}\cdot\alpha\right|<em>{\infty}\leq\alpha + 1$。此外，如果 $h$中 1的个数是 $\omega$，那么在以 $q$为模的中心约简后，$r - v</em>{1}\cdot\alpha$除了至多 $\omega$个系数外，其余系数的绝对值至多为$ \frac{\alpha}{2}$。 </p>
<h3 id="性质3"><a href="#性质3" class="headerlink" title="性质3"></a>性质3</h3><p>对于任意的$ h$，$h’$，如果 $UseHint_{q}(h,r,\alpha)&#x3D;UseHint_{q}(h’,r,\alpha)$，那么 h &#x3D; h’</p>
<h3 id="引理1的扩展"><a href="#引理1的扩展" class="headerlink" title="引理1的扩展"></a>引理1的扩展</h3><p>由引理1可以推出：$2\gamma_2 \cdot UseHint_q(h,Az-ct_1 \cdot2^d,2\gamma_2)&#x3D;Az-ct_1 \cdot 2^d$，其中$|u|_\infty \leq 2\gamma_2+1$。证明如下：</p>
<ol>
<li>$\gamma_2 &#x3D; \lceil \frac{q}{2^{d+1}} \rceil$；令$r&#x3D;Az-ct_1 \cdot 2^d$</li>
<li>由引理1的性质1：$UseHint_q(MakeHint_q(z, r, \alpha), r, \alpha) &#x3D; HighBits_q(r + z, \alpha)$可知当我们取$z&#x3D;u$和$\alpha&#x3D;2 \gamma_2$且$|u|_\infty \leq 2\gamma_2+1$时可以得到：$UseHint_q(MakeHint_q(u, r, 2 \gamma_2), r, 2 \gamma_2) &#x3D; HighBits_q(r + u, 2 \gamma_2)$</li>
<li>将$r&#x3D;Az-ct_1 \cdot 2^d$带入可以得到：$UseHint_q(MakeHint_q(u, Az - ct_1 \cdot 2^d, 2\gamma_2), Az - ct_1 \cdot 2^d, 2\gamma_2) &#x3D; HighBits_q(Az - ct_1 \cdot 2^d + u, 2\gamma_2)$</li>
<li>由引理1性质1，我们知道：$UseHint_q(h, Az - ct_1 \cdot 2^d, 2\gamma_2) &#x3D; HighBits_q(Az - ct_1 \cdot 2^d, 2\gamma_2)$，其中$h$是我们通过$MakeHint$生成的提示信息</li>
<li>由$HighBits_q$知$\alpha \cdot HighBits_q(x,\alpha) \approx x $，所以$2\gamma_2 \cdot HighBits_q(Az - ct_1 \cdot 2^d + u, 2\gamma_2) \approx Az - ct_1 \cdot 2^d + u$</li>
<li>4同时乘$2\gamma_2$并将5带入4中可以得到：$2\gamma_2 \cdot UseHint_q(h,Az-ct_1 \cdot2^d,2\gamma_2)&#x3D;Az-ct_1 \cdot 2^d + u$</li>
</ol>
<h2 id="引理2"><a href="#引理2" class="headerlink" title="引理2"></a>引理2</h2><p>如果$|s|<em>\infty \leq \beta$且$|LowBits_q(r,\alpha)|</em>\infty &lt; \frac{\alpha}{2}-\beta$，则$HighBits_q(r, \alpha) &#x3D; HighBits_q(r + s, \alpha)$</p>
<h2 id="引理3"><a href="#引理3" class="headerlink" title="引理3"></a>引理3</h2><p>当满足$(r_1, r_0) &#x3D; Decompose_q(r, \alpha), (w_1, w_0) &#x3D; Decompose_q(r + s, \alpha), |s|<em>\infty \leq \beta$时，有：$|s + r_0|</em>\infty &lt; \frac{\alpha}{2} - \beta \iff w_1 &#x3D; r_1 \land |w_0|_\infty &lt; \frac{\alpha}{2} - \beta$</p>
<h1 id="公开参数"><a href="#公开参数" class="headerlink" title="公开参数"></a>公开参数</h1><ol>
<li>XOF算法，原文采用了SHAKE256, 也可以换成其他的</li>
<li>多项式环：$R_q &#x3D; \mathbb{Z}_q[X]&#x2F;(X^{256} + 1)$，这里$q &#x3D; 2 ^{23} - 2 ^{13} + 1 &#x3D; 8380417$。环中的元素是模$q$的多项式，且每个多项式的最高次数为 255</li>
<li>$l \times k$: 公开的矩阵的大小，本文演示代码采用$4 \times 4$的矩阵，其他大小可以参考原始公开的文档</li>
<li>$d$: $t$丢弃的bit的长度</li>
<li>$\eta$: 私钥的系数的范围</li>
<li>$\gamma_1$: $y$的系数的范围</li>
<li>$\gamma_2$: low-order 的裁剪范围</li>
</ol>
<h1 id="密钥生成算法"><a href="#密钥生成算法" class="headerlink" title="密钥生成算法"></a>密钥生成算法</h1><ol>
<li><p>生成一个种子</p>
<ol>
<li>$\zeta \leftarrow {0,1}^{256}$，首先生成一个256bit的随机值，这个随机值呢，其实是不参与后面的交换过程的，只是为了生成后面的随机种子（$\rho, \rho’, K$）</li>
<li>采用的伪随机数算法采用基于哈希的伪随机数生成算法SHAKE-256或AES算法（理论上是可以换的），利用$H$函数分别生成$(\rho, \rho’, K) \in {0,1}^{256} \times {0,1}^{512} \times {0,1}^{256} :&#x3D; H(\zeta)$。即通过伪随机数生成算法将初始随机值$\zeta$通过哈希函数$H$转换为三个伪随机值$\rho、 \rho’、 K$<ol>
<li>$\rho \in {0,1}^{256}$是用于生成随机矩阵$A$的种子</li>
<li>$\rho’  \in {0,1}^{512}$和$K  \in {0,1}^{256}$在后续用于私钥和公钥的生成</li>
</ol>
</li>
</ol>
</li>
<li><p>通过这三个初始值可以用来生成密钥</p>
<ol>
<li>生成随机矩阵$A$：$A \in \mathbb{R}^{k \times l}_q :&#x3D; \text{ExpandA}(\rho)$，其中$A$ 是一个$ k×l$ 矩阵，元素属于有限域 $\mathbb{R}_q$。（这一步可以通过NTT算法优化加速）<ol>
<li>使用种子派生矩阵的原因：如果直接传输一个矩阵 $A$，它的传输数据量会非常庞大，特别是在密钥生成、签名或加密等步骤中，矩阵的大小可能会达到数百字节甚至更大。如果一个矩阵的大小非常大，这会在传输、存储和计算效率上带来显著的开销。而种子派生矩阵可以只传输256比特的种子，传输内容就极大的减小了。</li>
<li>派生矩阵的过程：为了减小传输内容的大小，算法采用了 种子$\rho$来派生出一个矩阵$A$。虽然种子本身只有 256 位（32 字节），但通过派生过程，可以从这个种子中获得一个非常大的矩阵或其他多项式结构</li>
<li>为什么通过派生可以减小传输内容：通过使用一个较小的种子值，并通过算法生成矩阵 $A$，可以保持信息的完整性，同时显著减小需要传输的数据量。种子只是一个固定长度的值（例如 256 位），而矩阵本身可能有成千上万的位数，但通过数学操作（如伪随机生成），可以从一个较小的种子生成矩阵，且接收方可以根据相同的算法来复原该矩阵。</li>
</ol>
</li>
<li>计算私钥<ol>
<li>：$(s_1, s_2) \in S_\eta^{\ell} \times S_\eta^k :&#x3D; \text{ExpandS}(\rho’)$<ol>
<li>这里$S_\eta$表示系数范围在$\eta$之内，这里私钥是一个系数较小的值。</li>
<li>$\ell$和 $k$是参数，决定了 $s_1, s_2$的维度。</li>
<li>$\text{ExpandS}(\rho’)$表示通过种子 $\rho’$ 和某种伪随机生成算法扩展得到这些值。</li>
</ol>
</li>
<li>$t :&#x3D; A s_1 + s_2$</li>
<li>$(t_1, t_0) :&#x3D; \text{Power2Round}_q(t, d)$，$\text{Power2Round}_q$是一个特殊的分解函数，将$t$分解为两个部分$t_1$和$t_0$，其中$t_1$是高位部分，$t_0$是低位部分。</li>
<li>计算一个值$\text{tr} \in {0,1}^{256} :&#x3D; H(\rho | t_1)$。这里，其实在签名的时候，再来计算也可以，就是私钥里面也放一下$t_1$就好了。</li>
<li>得到对应的私钥$\text{sk} &#x3D; (\rho, K, \text{tr}, s_1, s_2, t_0)$</li>
</ol>
</li>
<li>计算公钥：$\text{pk} &#x3D; (\rho, t_1)$（这里的$t_1$即前面计算私钥时的$t_1$）。公钥$\text{pk}$仅包含种子$\rho$和分解后的高位部分$t_1$，体积小且便于传输。</li>
<li>流程：<ol>
<li>生成一个随机种子，通过种子生成3个分别为256和512为的随机值</li>
<li>通过256位随机值生成派生矩阵A</li>
<li>通过扩展算法计算一个512位的随机值得到私钥的一部分，再以此计算出t，并保存t的低位作为私钥的一部分，对t的高位做处理后同样作为私钥的一部分</li>
<li>将前面生成随机矩阵A的256位随机值和t的高位作为公钥</li>
</ol>
</li>
</ol>
</li>
</ol>
<h1 id="签名算法"><a href="#签名算法" class="headerlink" title="签名算法"></a>签名算法</h1><ol>
<li>首先根据$\rho$来恢复矩阵$A$：$\mathbf{A} \in \mathbb{R}^{k \times l}_q :&#x3D; \text{ExpandA}(\rho)$</li>
<li>计算一个hash值：$\mu \in {0, 1}^{512} :&#x3D; H(tr \parallel M)$，消息$M$</li>
<li>生成一个随机值$\rho’$，这里可以采用$H$派生$\rho’ \in {0, 1}^{512} :&#x3D; H(K \parallel \mu)$，也可以随机取值$\rho’ \in {0, 1}^{512}$（和生成密钥中的$\rho’$有区别）</li>
<li>初始化变量：计数器$\kappa&#x3D;0$</li>
<li>进入循环，判断条件：$(z, h) :&#x3D;\perp$<ol>
<li>随机生成y的值：$y \in S_{\gamma_1}^{l} :&#x3D; \text{ExpandMask}(\rho’, \kappa)$，其中$y$的系数范围是通过$\gamma_1$来决定的</li>
<li>计算：$w :&#x3D; A y$</li>
<li>读取$w$的高位：$w_1 :&#x3D; \text{HighBits}_{\gamma_2}(w, 2\gamma_2)$</li>
<li>计算一个倍数值，并将其转换成一个多项式：$\tilde{c} \in {0,1}^{256} :&#x3D; H(\mu | w_1)，c \in B_{\tau} :&#x3D; \text{SampleInBall}(\tilde{c})$</li>
<li>计算：$z :&#x3D; y + c s_1，r_0 :&#x3D; \text{LowBits}_{\gamma_2}(w - c s_2, 2\gamma_2)$</li>
<li>这里需要判断$z$和$r_0$的范数，是否在范围之内。当$||z||<em>{\infty} \geq \gamma_1 - \beta \quad or \quad ||r_0||</em>{\infty} \geq \gamma_2 - \beta$时，$(z, h) :&#x3D;\perp$并跳转到5.8</li>
<li>当$z$和$r_0$的范数不满足5.6中的条件时，计算$h$的值，$h :&#x3D; \text{MakeHint}_{q}(-c t_0, w - c s_2 + c t_0, 2\gamma_2) $<ol>
<li>当$||c t_0||_{\infty} \geq \gamma_2 $或$h$的汉明重量大于$w$时，$(z, h) :&#x3D;\perp$并跳转到5.8</li>
<li>当不满足上面5.7.1的条件时，$k&#x3D;k+1，\sigma &#x3D; (\tilde{c}, z, h)$并<strong>退出循环</strong>（<strong>此时满足的条件：</strong>$||z||<em>{\infty} &lt; \gamma_1 - \beta$ 、$||r_0||</em>{\infty} &lt; \gamma_2 - \beta$、$||c t_0||_{\infty} &lt; \gamma_2$ 以及 $h$的汉明重量小于$w$），返回$\sigma &#x3D; (\tilde{c}, z, h)$作为最终签名内容</li>
</ol>
</li>
<li>$k&#x3D;k+1$，并跳转到5.1符合判断条件后继续循环。<ol>
<li>在这里$k$的作用主要是用来控制循环的次数，它并不直接影响签名的计算方式。计数器的步长变化主要影响的是算法的执行效率，而不是安全性。实现者可以根据实际情况调整步长，所以在一些关于CRYSTALS-Dilithium算法讲解的网页中步长可能不是1而是其他数值（如$\ell$等）</li>
</ol>
</li>
</ol>
</li>
<li>签名结果：$\sigma &#x3D; (\tilde{c}, z, h)$</li>
<li>流程：<ol>
<li>通过私钥中的的值恢复随机矩阵A</li>
<li>计算消息的hash值</li>
<li>进入循环计算，直到找到符合条件的值</li>
</ol>
</li>
</ol>
<h1 id="验签算法"><a href="#验签算法" class="headerlink" title="验签算法"></a>验签算法</h1><ol>
<li>首先，判断$h、z$的范围（$|z|_\infty&lt;\gamma_1-\beta$并且$h$的汉明重量小于$w$），是不是合理，不合理，直接返回验签失败</li>
<li>首先根据$\rho$来恢复矩阵$\mathbf{A}$：$\mathbf{A} \in \mathbb{R}^{k \times l}_q :&#x3D; \text{ExpandA}(\rho)$</li>
<li>计算$\mu$的值，这里和私钥计算的值是一样的$\mu \in {0, 1}^{512} :&#x3D; H(tr \parallel M)$</li>
<li>恢复$c$的值，得到一个多项式$c:&#x3D;SampleInBall(\tilde{c})$</li>
<li>计算$w_1’ :&#x3D; \text{UseHint}_q(h, \mathbf{A}z - ct_1 \cdot 2^d, 2\gamma_2)$</li>
<li>验签$\tilde{c} &#x3D; H(\mu | w_1’)$，计算$\tilde{c}$和传输过来的是否一致，如果一致，验签成功，否则，验签失败。</li>
<li>流程：<ol>
<li>通过公钥中值恢复随机矩阵$\mathbf{A}$</li>
<li>计算消息的hash值</li>
<li>计算对比值是否正确</li>
</ol>
</li>
</ol>
<h1 id="签名原理（正确性证明）"><a href="#签名原理（正确性证明）" class="headerlink" title="签名原理（正确性证明）"></a>签名原理（正确性证明）</h1><ol>
<li>签名时：$w_1&#x3D; \text{HighBits}_{\gamma_2}(w, 2\gamma_2),\tilde{c}&#x3D; H(\mu | w_1)$</li>
<li>验签时：$w_1’ :&#x3D; UseHint_q(h, \mathbf{A}z - ct_1 \cdot 2^d, 2\gamma_2)，\tilde{c} &#x3D; H(\mu | w_1’)$，计算$\tilde{c}$和传输过来的是否一致，如果一致，验签成功，否则，验签失败。</li>
<li>所以只用证明$w_1 &#x3D; w_1’$即可完成正确性证明</li>
</ol>
<h2 id="正确性证明"><a href="#正确性证明" class="headerlink" title="正确性证明"></a>正确性证明</h2><ol>
<li>令$h :&#x3D; \text{MakeHint}<em>{q}(-c t_0, w - c s_2 + c t_0, 2\gamma_2) $，$z&#x3D;-ct_0, r&#x3D;w-cs_2+ct_0，\alpha &#x3D; 2\gamma_2$带入<strong>引理1</strong>$UseHint</em>{q}(MakeHint_{q}(z,r,\alpha),r,\alpha)&#x3D;HighBits_{q}(r + z,\alpha)$，其中满足$|z|<em>\infty \leq \frac{\alpha}{2}$即$|ct_0|</em>\infty &lt;\gamma_2$所以有$UseHint_q(h,w-cs_2+ct_0,2\gamma_2) &#x3D; HighBits_q(w-cs_2,2\gamma_2)$</li>
<li>因为$w&#x3D;\mathbf{A}y$ and $t&#x3D;\mathbf{A}s_1+s_2$，所以$w - cs_2 &#x3D; \mathbf{A}y-cs_2&#x3D;\mathbf{A}(z-cs_1)-cs_2&#x3D;\mathbf{A}z-ct$</li>
<li>因为$(t_1, t_0) :&#x3D; \text{Power2Round}_q(t, d)$，所以有$ct &#x3D; c(t_1 \cdot 2^d + t_0)&#x3D;ct_1 \cdot 2^d + ct_0$。所以$w-cs_2 + ct_0 &#x3D; \mathbf{A}z-ct + ct_0 &#x3D; \mathbf{A}z - ct_1 \cdot 2^d$，所以有$UseHint_q(h,w-cs_2+ct_0,2\gamma_2) &#x3D; UseHint_q(h,\mathbf{A}z - ct_1 \cdot 2^d,2\gamma_2)&#x3D;HighBits_q(w-cs_2,2\gamma_2) $</li>
<li>因为$|cs_2|<em>\infty \leq \beta$且$|LowBits_q(w-cs_2,2\gamma_2)|</em>\infty &lt; \gamma_2-\beta$，所以由<strong>引理2</strong>得$HighBits_q(w-cs_2,2\gamma_2) &#x3D; HighBits_q(w-cs_2+cs_2,2\gamma_2)&#x3D;HighBits_q(w,2\gamma_2)&#x3D;w_1$</li>
<li>所以$w_1’ &#x3D; UseHint_q(h, \mathbf{A}z - ct_1 \cdot 2^d, 2\gamma_2)&#x3D;HighBits_q(w,2\gamma_2)&#x3D;w_1$，证毕</li>
</ol>
<h1 id="形式化安全分析（安全规约）"><a href="#形式化安全分析（安全规约）" class="headerlink" title="形式化安全分析（安全规约）"></a>形式化安全分析（安全规约）</h1><p>遵循 <strong>挑战者-攻击者模型</strong> 和 <strong>随机预言模型（ROM）</strong>，并规约到相关的数学困难问题（如 MLWE 、SelfTargetMSIS和 MSIS）。</p>
<h2 id="1-密钥恢复（Key-Recovery）的形式化安全分析"><a href="#1-密钥恢复（Key-Recovery）的形式化安全分析" class="headerlink" title="1. 密钥恢复（Key Recovery）的形式化安全分析"></a><strong>1. 密钥恢复（Key Recovery）的形式化安全分析</strong></h2><h3 id="安全目标"><a href="#安全目标" class="headerlink" title="安全目标"></a><strong>安全目标</strong></h3><p>攻击者不能从公钥 $(A,t)$中恢复私钥$ (s_1, s_2)$。</p>
<h3 id="攻击模型"><a href="#攻击模型" class="headerlink" title="攻击模型"></a><strong>攻击模型</strong></h3><p>攻击者$\mathcal{A}$被赋予如下能力：</p>
<ul>
<li>知道公钥$ t &#x3D; \mathbf{A} \cdot s_1 + s_2$；</li>
<li>知道系统参数$\mathbf{A}$和签名算法的实现；</li>
<li>攻击目标是从 $(\mathbf{A}, t)$中恢复$s_1, s_2$。</li>
</ul>
<h3 id="安全性定义"><a href="#安全性定义" class="headerlink" title="安全性定义"></a><strong>安全性定义</strong></h3><ol>
<li><p>CRYSTALS-Dilithium 的密钥恢复安全性规约到 <strong>模块化学习同余问题（MLWE）</strong>。</p>
</li>
<li><p>**MLWE 问题：**给定$ \mathbf{A} \in R_q^{m \times k}$和 $t \in R_q^m$，区分以下两种分布：</p>
</li>
<li><p>$t &#x3D; \mathbf{A} \cdot s_1 + s_2$，其中 $s_1, s_2$ 是从高斯分布中独立采样的短向量；</p>
</li>
<li><p>$t$是从均匀分布中随机生成的。</p>
</li>
</ol>
<p>如果攻击者能够破解密钥恢复问题，则可以有效地区分上述两种分布。</p>
<h3 id="形式化证明"><a href="#形式化证明" class="headerlink" title="形式化证明"></a><strong>形式化证明</strong></h3><ol>
<li><strong>挑战设置：</strong><br>挑战者 $\mathcal{C} $初始化系统参数：<ul>
<li>生成 $\mathbf{A}$ 和 $t$，满足 $t &#x3D; \mathbf{A} \cdot s_1 + s_2$，其中$s_1, s_2$是短向量。</li>
<li>将$(\mathbf{A}, t)$提供给攻击者 $\mathcal{A}$。</li>
</ul>
</li>
<li><strong>攻击者能力：</strong><br>$\mathcal{A}$接收$(\mathbf{A}, t)$并尝试恢复$s_1, s_2$</li>
<li>**规约到 MLWE：**如果攻击者$\mathcal{A}$能够成功恢复私钥$sk$，那么说明攻击者$\mathcal{A}$能够识别出$t$是从均匀分布中随机生成的还是$t &#x3D; \mathbf{A} \cdot s_1 + s_2$（其中$s_1$,$s_2$是从高斯分布中独立采样的短向量）并从$t &#x3D; \mathbf{A} \cdot s_1 + s_2$中成功恢复$s_1$,$s_2$，这证明攻击者$\mathcal{A}$能够高效破解MLWE问题，与MLWE问题的计算困难性假设矛盾，所以证明定理1。同时因为MLWE问题的困难性，公钥$pk&#x3D;(A,t)$中的$t$和从均匀分布中随机生成的$t$没有区别。</li>
<li><strong>归谬证明：</strong><br>假设存在一个攻击者能够破解密钥恢复问题，则他能够高效破解 MLWE 问题。这与 MLWE 的计算困难性假设矛盾。</li>
</ol>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a><strong>结论</strong></h3><p>密钥恢复的安全性直接规约到 MLWE 的困难性。</p>
<hr>
<h2 id="2-新消息伪造（UF-CMA）的形式化安全分析"><a href="#2-新消息伪造（UF-CMA）的形式化安全分析" class="headerlink" title="2. 新消息伪造（UF-CMA）的形式化安全分析"></a><strong>2. 新消息伪造（UF-CMA）的形式化安全分析</strong></h2><h3 id="安全目标-1"><a href="#安全目标-1" class="headerlink" title="安全目标"></a><strong>安全目标</strong></h3><p>攻击者不能在选定消息攻击（CMA）模型下伪造未签名消息$M’$的有效签名$\sigma’$。</p>
<p>由文献[1]中6.2.1的论证可知，对于零知识确定性签名方案，如果攻击者能够利用量子访问哈希函数$H$和经典访问签名Oracle的能力在UF-CMA模型下伪造一个新的消息签名，那么实际上可以通过构造一个不需要访问签名Oracle的攻击者在UF-NMA模型下完成伪造新的消息签名。因此，基于CRYSTALS-Dilithium签名算法的数学特性以及文献[1]提出的归约方法以及确定性签名方案的特性，可以通过模拟签名Oracle的行为实现从UF-CMA到UF-NMA的安全性归约。所以当证明CRYSTALS-Dilithium签名算法在UF-NMA模型下是安全的，即可推出其在UF-CMA模型下的安全性。下面证明CRYSTALS-Dilithium签名算法在UF-NMA模型下的安全性：</p>
<p>[1]CRYSTALS-Dilithium Algorithm Specifications and Supporting Documentation(Version 3.1)</p>
<h3 id="攻击模型-1"><a href="#攻击模型-1" class="headerlink" title="攻击模型"></a><strong>攻击模型</strong></h3><ol>
<li>攻击者$ \mathcal{A} $被赋予如下能力：<ol>
<li>查询公钥接口</li>
<li><strong>伪造目标</strong> ：输出一个未签名消息$ M’ $和有效签名 $\sigma’ &#x3D; (z’, h’, c’)$</li>
</ol>
</li>
<li>攻击者的目标是生成一个有效签名，使得验证者认为签名有效，且消息 $M’$没有在之前的签名查询中请求过。</li>
</ol>
<h3 id="安全性定义-1"><a href="#安全性定义-1" class="headerlink" title="安全性定义"></a><strong>安全性定义</strong></h3><ol>
<li>CRYSTALS-Dilithium 的新消息伪造安全性规约到 <strong>自目标模块化短整数解问题（SelfTargetMSIS）</strong>。</li>
<li>**SelfTargetMSIS 问题：**给定矩阵$ A $和哈希函数$ H$，找到一个向量 $y &#x3D; [z, c, u]$，满足：$[I \ | \mathbf{A}] \cdot y &#x3D; t’$,其中 $|y|_\infty \leq \gamma$，且 $t’$满足签名验证公式的约束。</li>
</ol>
<h3 id="形式化证明-1"><a href="#形式化证明-1" class="headerlink" title="形式化证明"></a><strong>形式化证明</strong></h3><ol>
<li><strong>挑战设置：</strong><ol>
<li><p>初始化：挑战者 $\mathcal{C}$执行以下步骤：</p>
<ol>
<li>随机生成系统参数，包括公钥矩阵$\mathbf{A}$、私钥$(s_1, s_2)$，以及哈希函数 $H$</li>
<li>计算公钥$(\mathbf{A}, t&#x3D;As_1+s_2)$</li>
<li>向攻击者$\mathcal{A}$提供公钥$(\mathbf{A},t)$</li>
</ol>
</li>
<li><p>签名验证公式可化简为： $H(\mu|UseHint(h, \mathbf{A}z - ct_1 \cdot 2^d, 2\gamma_2)) &#x3D; c$，其中：</p>
<ol>
<li>$\mu$是消息$M$的消息摘要：$\mu &#x3D;Hash(Hash(\rho ||t_{high})||M)$</li>
<li>$h$是生成的提示信息</li>
<li>$t_1$是公钥$t$的高位部分</li>
</ol>
</li>
</ol>
</li>
<li>公钥查询接口<ol>
<li>将攻击者查询的公钥提供给攻击者</li>
</ol>
</li>
<li><strong>攻击者伪造签名的条件</strong><ol>
<li>攻击者$ \mathcal{A} $成功伪造签名$ \sigma’ &#x3D; (z’, h’, c’) $的条件是：<ol>
<li>签名验证公式成立：$H(\mu’ | UseHint_q(h’, \mathbf{A}z’ - c’t_1 \cdot 2^d, 2\gamma_2)) &#x3D; c’$</li>
<li>消息$ M’ $没有在签名查询中被请求过。</li>
</ol>
</li>
</ol>
</li>
<li><strong>将伪造的签名规约到 SelfTargetMSIS：</strong><ol>
<li>由引理1可以得到：$2\gamma_2 \cdot UseHint_q(h,\mathbf{A}z-ct_1 \cdot2^d,2\gamma_2)&#x3D;\mathbf{A}z-ct_1 \cdot 2^d +u&#x3D;&gt;UseHint_q(h,\mathbf{A}z-ct_1 \cdot2^d,2\gamma_2)&#x3D;\frac{1}{2\gamma_2}\cdot(\mathbf{A}z-ct_1 \cdot 2^d + u)$</li>
<li>我们令$t&#x3D;t_1 \cdot 2^d+ t_0$，其中$|t_0|<em>\infty\leq2^{d-1}$。可以得到：$\mathbf{A}z - ct</em>{1} \cdot 2^{d} + u &#x3D; \mathbf{A}z - c(t - t_{0}) + u &#x3D; \mathbf{A}z - ct + (ct_{0} + u) &#x3D; \mathbf{A}z - ct + u’$</li>
<li>我们可以得到$u’$最坏情况下的上限$|u’|<em>{\infty} \leq |ct</em>{0}|<em>{\infty} + |u|</em>{\infty} \leq |c|<em>{1} \cdot |t</em>{0}|<em>{\infty} + |u|</em>{\infty} \leq \tau \cdot 2^{d - 1} + 2\gamma_{2} + 1$</li>
<li>因此敌手$\mathcal{A}$如果能够成功伪造签名信息$ \sigma’ &#x3D; (z’, h’, c’) $，就能找到$z’,c’,u’,M$满足$|z’|<em>{\infty}&lt;\gamma</em>{1}-\beta,|c’|<em>{\infty}&#x3D;1,|u’|</em>{\infty}\leq\tau\cdot2^{d - 1}+2\gamma_{2}+1$, $H(\mu’ | UseHint_q(h’, \mathbf{A}z’ - c’t_1 \cdot 2^d, 2\gamma_2)) &#x3D; c’$,以及 $h$的汉明重量小于$w$）由此可以得到：$H(\mu|UseHint_q(h’, \mathbf{A}z’ - c’t_1 \cdot 2^d, 2\gamma_2)) &#x3D; H\left(\mu \left|\frac{1}{2\gamma_{2}}\cdot\left[\mathbf{A}|t|I_{k}\right]\cdot\left[\begin{array}{c}z’\c’\u’\end{array}\right]\right.\right)&#x3D;c$</li>
<li>为了简化公式，我们定义函数$H’$满足$H(\mu |x)&#x3D;H’(\mu|2\gamma_2x)$，得到：$H’\left(\mu \left|\left[\mathbf{A}|t|I_{k}\right]\cdot\left[\begin{array}{c}z’\c’\u’\end{array}\right]\right.\right)&#x3D;c$</li>
<li>令$t’&#x3D; \mathbf{A}z’-c’t+u’$，则有$\left[\mathbf{A}|t|I_{k}\right]\cdot\left[\begin{array}{c}z’\c’\u’\end{array}\right]&#x3D;t’$，即存在一个短向量$y’ &#x3D; \left[\begin{array}{c}z’\c’\u’\end{array}\right]$，满足：$[I \ | \mathbf{A}] \cdot y’ &#x3D; t’$，其中 $|y’|_\infty \leq \gamma$。</li>
<li>这正是 <strong>SelfTargetMSIS 问题</strong> 的定义：在给定矩阵$[I ∣A] $和目标值 $t’$的情况下，找到一个短向量 $y &#x3D; \left[\begin{array}{c}z’\c’\u’\end{array}\right]$，满足：$[I \ | \mathbf{A}] \cdot y &#x3D; t’$，其中 $|y|_\infty \leq \gamma$。</li>
</ol>
</li>
<li>**归谬证明：**如果攻击者$ \mathcal{A}$ 能够在选定消息攻击（CMA）模型下伪造签名，则：他能够有效找到一个 $y &#x3D; [z’, c’, u’]$，满足 SelfTargetMSIS 问题的定义。那么他就能够破解 SelfTargetMSIS 问题。这与 SelfTargetMSIS 的困难性假设矛盾。</li>
</ol>
<h3 id="结论-1"><a href="#结论-1" class="headerlink" title="结论"></a><strong>结论</strong></h3><p>新消息伪造的安全性规约到 SelfTargetMSIS 的困难性。</p>
<hr>
<h2 id="3-强不可伪造性（SUF-CMA）的形式化安全分析"><a href="#3-强不可伪造性（SUF-CMA）的形式化安全分析" class="headerlink" title="3. 强不可伪造性（SUF-CMA）的形式化安全分析"></a><strong>3. 强不可伪造性（SUF-CMA）的形式化安全分析</strong></h2><h3 id="安全目标-2"><a href="#安全目标-2" class="headerlink" title="安全目标"></a><strong>安全目标</strong></h3><p>攻击者不能在选定消息攻击（CMA）模型下伪造任何签名消息$M$的有效签名$\sigma’$。</p>
<h3 id="攻击模型-2"><a href="#攻击模型-2" class="headerlink" title="攻击模型"></a><strong>攻击模型</strong></h3><p>基于上面新消息伪造的证明，只用证明：无法基于$\sigma$构造出新的有效签名$\sigma’$</p>
<ul>
<li>攻击者$ \mathcal{A} $被赋予如下能力：<ol>
<li>查询公钥接口</li>
<li>查询签名接口，获得$\sigma &#x3D; (z, h, c)$</li>
<li><strong>伪造目标</strong> ：<ol>
<li>输出一个消息$ M $和有效签名 $\sigma’ &#x3D; (z’, h’, c)$</li>
<li>消息$ M $的签名$\sigma’$之前没有被查询过，即使是查询过消息$ M $的签名，只要构造的有效签名$\sigma’$并不是查询到的而是构造出来的</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="安全性定义-2"><a href="#安全性定义-2" class="headerlink" title="安全性定义"></a><strong>安全性定义</strong></h3><ol>
<li>CRYSTALS-Dilithium 的强不可伪造性规约到 <strong>模块化短整数解问题（MSIS）</strong>。</li>
<li>**MSIS 问题：**给定矩阵 $\mathbf{A}$，找到非零短向量$y$，满足：$[I | \mathbf{A}] \cdot y &#x3D; 0$，且$ |y|_\infty \leq \gamma$</li>
</ol>
<h3 id="形式化证明-2"><a href="#形式化证明-2" class="headerlink" title="形式化证明"></a><strong>形式化证明</strong></h3><ol>
<li><p><strong>挑战设置：</strong><br>挑战者$\mathcal{C} $初始化：</p>
<ul>
<li>系统参数 $\mathbf{A}$、签名公式 $\sigma &#x3D; (z, h, c)$</li>
</ul>
</li>
<li><p><strong>攻击者能力：</strong><br>$\mathcal{A}$能够查询公钥和签名并且能只改变签名中的$(z,h)$，并尝试找到 $\sigma \neq \sigma’$，满足：</p>
<p>$H(\mu|UseHint_q(h’, \mathbf{A}z’ - ct_1 \cdot 2^d, 2\gamma_2))&#x3D;H(\mu|UseHint(h, \mathbf{A}z - ct_1 \cdot 2^d, 2\gamma_2))&#x3D;c$</p>
</li>
<li><p><strong>规约到 MSIS：</strong></p>
<ol>
<li>如果 $\mathcal{A}$成功伪造出签名$\sigma’$签名，则$UseHint_q(h, \mathbf{A}z - ct_1 \cdot 2^d, 2\gamma_2) &#x3D; UseHint_q(h’, \mathbf{A}z’ - ct_1 \cdot 2^d, 2\gamma_2)$</li>
<li>所以$\frac{1}{2\gamma_2}\cdot(\mathbf{A}z-ct_1 \cdot 2^d + u)&#x3D;\frac{1}{2\gamma_2}\cdot(\mathbf{A}z’-ct_1 \cdot 2^d + u)$，两式相减得到：$ \mathbf{A} \cdot (z - z’) + u &#x3D; 0$, 令 $y &#x3D; \left[\begin{array}{c}z-z’\u\end{array}\right]$，则可以变形为$[I | \mathbf{A}] \cdot y &#x3D; 0$，其中$y$是一个短向量，满足 MSIS 的定义。</li>
</ol>
</li>
<li><p><strong>归谬证明：</strong><br>如果$ \mathcal{A} $能够生成有效签名$\sigma’$，则能够通过这个算法找到有效的短向量$y$，满足 MSIS 问题定义。那么他就能够破解 MSIS 问题。这与MSIS 的困难性假设矛盾。</p>
</li>
</ol>
<h3 id="结论-2"><a href="#结论-2" class="headerlink" title="结论"></a><strong>结论</strong></h3><p>强不可伪造性的安全性规约到 MSIS 的困难性。</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>CRYSTALS-Dilithium 的安全性分析如下：</p>
<ol>
<li><strong>密钥恢复</strong>规约到 <strong>MLWE</strong>；</li>
<li><strong>新消息伪造</strong>规约到 <strong>SelfTargetMSIS</strong>；</li>
<li><strong>强不可伪造性</strong>规约到 <strong>MSIS</strong>。</li>
</ol>
<p>最终安全界限为：</p>
<p>$Adv_{SUF-CMA} \leq Adv_{MLWE} + Adv_{SelfTargetMSIS} + Adv_{MSIS} + \text{negligible terms}$</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://likwater.github.io">Water</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://likwater.github.io/2025/05/29/CRYSTALS-Dilithium/">https://likwater.github.io/2025/05/29/CRYSTALS-Dilithium/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://likwater.github.io" target="_blank">Water's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/crypto/">crypto</a><a class="post-meta__tags" href="/tags/post-quantum/">post-quantum</a><a class="post-meta__tags" href="/tags/digital-signatur/">digital signatur</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/%5Bobject%20Object%5D" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/03/01/%E5%8C%BA%E5%9D%97%E9%93%BE/" title="truffle部署"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">truffle部署</div></div><div class="info-2"><div class="info-item-1">truffle init 初始化项目  修改生成的truffle-config.js文件，使之和环境匹配 12345678910111213141516171819202122232425262728293031323334353637module.exports = &#123;  networks: &#123;    // Ganache 本地开发网络配置    development: &#123;      host: &quot;127.0.0.1&quot;,     // Ganache 本地主机地址      port: 7545,            // Ganache 默认端口      network_id: &quot;*&quot;,       // 匹配任意网络 ID      gas: 1000000,         // Gas 限制，确保足够      gasPrice: 20000000000, // Gas 价格，设置为 20 gwei    &#125;,  &#125;,  // Mocha 配置  mocha: &#123;...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Water</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/likwater"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">上善若水</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">1.</span> <span class="toc-text">参考文献</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%B0%E9%9A%BE%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">困难问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E7%AC%A6%E5%8F%B7"><span class="toc-number">3.</span> <span class="toc-text">数学符号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">算法中调用的函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">引理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%90%861"><span class="toc-number">5.1.</span> <span class="toc-text">引理1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%B4%A81"><span class="toc-number">5.1.1.</span> <span class="toc-text">性质1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%B4%A82"><span class="toc-number">5.1.2.</span> <span class="toc-text">性质2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%B4%A83"><span class="toc-number">5.1.3.</span> <span class="toc-text">性质3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%90%861%E7%9A%84%E6%89%A9%E5%B1%95"><span class="toc-number">5.1.4.</span> <span class="toc-text">引理1的扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%90%862"><span class="toc-number">5.2.</span> <span class="toc-text">引理2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%90%863"><span class="toc-number">5.3.</span> <span class="toc-text">引理3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%BC%80%E5%8F%82%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">公开参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95"><span class="toc-number">7.</span> <span class="toc-text">密钥生成算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95"><span class="toc-number">8.</span> <span class="toc-text">签名算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%8C%E7%AD%BE%E7%AE%97%E6%B3%95"><span class="toc-number">9.</span> <span class="toc-text">验签算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E5%8E%9F%E7%90%86%EF%BC%88%E6%AD%A3%E7%A1%AE%E6%80%A7%E8%AF%81%E6%98%8E%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">签名原理（正确性证明）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E6%80%A7%E8%AF%81%E6%98%8E"><span class="toc-number">10.1.</span> <span class="toc-text">正确性证明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BD%A2%E5%BC%8F%E5%8C%96%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%EF%BC%88%E5%AE%89%E5%85%A8%E8%A7%84%E7%BA%A6%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">形式化安全分析（安全规约）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AF%86%E9%92%A5%E6%81%A2%E5%A4%8D%EF%BC%88Key-Recovery%EF%BC%89%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%8C%96%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90"><span class="toc-number">11.1.</span> <span class="toc-text">1. 密钥恢复（Key Recovery）的形式化安全分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%AE%E6%A0%87"><span class="toc-number">11.1.1.</span> <span class="toc-text">安全目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">11.1.2.</span> <span class="toc-text">攻击模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E5%AE%9A%E4%B9%89"><span class="toc-number">11.1.3.</span> <span class="toc-text">安全性定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%A2%E5%BC%8F%E5%8C%96%E8%AF%81%E6%98%8E"><span class="toc-number">11.1.4.</span> <span class="toc-text">形式化证明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">11.1.5.</span> <span class="toc-text">结论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%96%B0%E6%B6%88%E6%81%AF%E4%BC%AA%E9%80%A0%EF%BC%88UF-CMA%EF%BC%89%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%8C%96%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90"><span class="toc-number">11.2.</span> <span class="toc-text">2. 新消息伪造（UF-CMA）的形式化安全分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%AE%E6%A0%87-1"><span class="toc-number">11.2.1.</span> <span class="toc-text">安全目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9E%8B-1"><span class="toc-number">11.2.2.</span> <span class="toc-text">攻击模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E5%AE%9A%E4%B9%89-1"><span class="toc-number">11.2.3.</span> <span class="toc-text">安全性定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%A2%E5%BC%8F%E5%8C%96%E8%AF%81%E6%98%8E-1"><span class="toc-number">11.2.4.</span> <span class="toc-text">形式化证明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA-1"><span class="toc-number">11.2.5.</span> <span class="toc-text">结论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%BC%BA%E4%B8%8D%E5%8F%AF%E4%BC%AA%E9%80%A0%E6%80%A7%EF%BC%88SUF-CMA%EF%BC%89%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%8C%96%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90"><span class="toc-number">11.3.</span> <span class="toc-text">3. 强不可伪造性（SUF-CMA）的形式化安全分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9B%AE%E6%A0%87-2"><span class="toc-number">11.3.1.</span> <span class="toc-text">安全目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9E%8B-2"><span class="toc-number">11.3.2.</span> <span class="toc-text">攻击模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E5%AE%9A%E4%B9%89-2"><span class="toc-number">11.3.3.</span> <span class="toc-text">安全性定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%A2%E5%BC%8F%E5%8C%96%E8%AF%81%E6%98%8E-2"><span class="toc-number">11.3.4.</span> <span class="toc-text">形式化证明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA-2"><span class="toc-number">11.3.5.</span> <span class="toc-text">结论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">11.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/29/CRYSTALS-Dilithium/" title="CRYSTALS-Dilithium">CRYSTALS-Dilithium</a><time datetime="2025-05-29T09:29:17.182Z" title="发表于 2025-05-29 17:29:17">2025-05-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/01/%E5%8C%BA%E5%9D%97%E9%93%BE/" title="truffle部署">truffle部署</a><time datetime="2025-03-01T11:56:19.000Z" title="发表于 2025-03-01 19:56:19">2025-03-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/01/python/" title="python">python</a><time datetime="2025-03-01T11:56:03.000Z" title="发表于 2025-03-01 19:56:03">2025-03-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/01/sql%E6%B3%A8%E5%85%A5/" title="SQL注入">SQL注入</a><time datetime="2025-03-01T11:55:06.000Z" title="发表于 2025-03-01 19:55:06">2025-03-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/01/%E5%AF%86%E7%A0%81%E7%AC%94%E8%AE%B0/" title="密码笔记">密码笔记</a><time datetime="2025-03-01T07:25:20.000Z" title="发表于 2025-03-01 15:25:20">2025-03-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 By Water</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.3</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章中……" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>